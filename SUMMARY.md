# 智能配票算法项目概览

## 项目说明

本项目实现了一套完整的智能票据分配系统，包括算法设计文档和可执行代码实现。

## 文档列表

### 1. 业务与算法文档

| 文档 | 说明 |
| --- | --- |
| [智能配票算法逻辑.md](智能配票算法逻辑.md) | 业务目标、偏好设置、拆票规则、约束条件等业务逻辑描述 |
| [数学模型.md](数学模型.md) | 数学建模、符号定义、目标函数、约束条件、求解方法 |
| [算法流程设计.md](算法流程设计.md) | 算法执行流程、模块划分、代码映射、扩展建议 |

### 2. 使用文档

| 文档 | 说明 |
| --- | --- |
| [README.md](README.md) | 项目快速入门、核心特性、使用示例 |
| [docs/使用指南.md](docs/使用指南.md) | 详细的配置说明、使用场景、故障排查 |

## 代码结构

```
src/                          # 源代码包
├── __init__.py              # 包导出
├── models.py                # 数据模型（票据、订单、配置、结果）
├── scoring.py               # 四维度得分计算
├── constraints.py           # 约束检查与校验
├── splitter.py              # 拆票逻辑
├── allocator.py             # 核心分配引擎
├── utils.py                 # 工具函数
└── example.py               # 简单示例

examples/                     # 使用示例
└── basic_example.py         # 五个典型场景示例

tests/                        # 测试代码
└── test_basic.py            # 基础功能测试

docs/                         # 文档目录
└── 使用指南.md              # 详细使用指南
```

## 快速开始

### 1. 运行简单示例

```bash
python -m src.example
```

### 2. 运行完整示例集

```bash
python examples/basic_example.py
```

### 3. 运行测试

```bash
python tests/test_basic.py
```

## 核心功能模块说明

### models.py - 数据模型
定义系统中的所有数据结构：
- **Ticket**: 票据对象，包含金额、到期天数、承兑人分类等属性
- **PaymentOrder**: 付款单对象
- **AllocationConfig**: 完整的配置对象
- **AllocationResult**: 分配结果

### scoring.py - 得分计算
实现四个维度的偏好得分计算：
- **到期期限维度**: 支持优先远期/近期策略
- **承兑人分类维度**: 支持优先好/差的承兑人
- **金额策略维度**: 支持6种不同的金额策略
- **承兑组织维度**: 支持优先同组织/不同组织

### constraints.py - 约束检查
实现各类约束的校验：
- 票据可用范围过滤（到期、金额、承兑人分类）
- 票据数量约束
- 小额票张数与覆盖度约束
- 拆票约束（最小留存、最小使用、比例限制）

### splitter.py - 拆票模块
实现智能拆票逻辑：
- 差额计算与尾差判定
- 补票场景：从票据池选择新票拆分
- 超额场景：调整已选票据使用金额
- 多种拆票选择策略

### allocator.py - 分配引擎
核心流程编排：
1. 票据预处理与过滤
2. 等额配票尝试
3. 偏好得分计算
4. 贪心组合构建
5. 拆票调节
6. 约束验证
7. 结果封装

## 算法特点

### 1. 多目标优化
- 四个维度加权求和
- 权重可灵活配置
- 支持强制穿透策略

### 2. 智能拆票
- 自动判断是否需要拆票
- 多种拆票策略可选
- 严格的拆票约束保护

### 3. 灵活约束
- 支持多种业务约束
- 约束违反时提供详细警告
- 可动态调整约束参数

### 4. 批量处理
- 支持多订单批量配票
- 票据池自动更新
- 按优先级自动排序

## 扩展性

### 1. 易于扩展新策略
在 `scoring.py` 中添加新的得分计算函数即可。

### 2. 易于添加新约束
在 `constraints.py` 中添加新的校验函数。

### 3. 支持自定义配置
所有配置参数都可通过配置对象自定义。

### 4. 模块化设计
各模块职责清晰，易于单独测试和替换。

## 性能说明

- **票据数量**: 当前实现适用于票据数 ≤ 1000
- **订单数量**: 支持批量处理大量订单
- **算法复杂度**: O(n log n)，主要为排序开销
- **优化方向**: 可引入更强的组合优化算法（整数规划、遗传算法）

## 技术栈

- **Python**: 3.7+
- **依赖**: 仅使用Python标准库，无外部依赖
- **数据结构**: dataclass + 面向对象
- **编程范式**: 函数式 + 面向对象混合

## 文件清单

### 文档文件（5个）
1. 智能配票算法逻辑.md - 业务逻辑
2. 数学模型.md - 数学建模
3. 算法流程设计.md - 流程设计
4. README.md - 项目说明
5. docs/使用指南.md - 使用指南

### 代码文件（10个）
1. src/__init__.py - 包初始化
2. src/models.py - 数据模型
3. src/scoring.py - 得分计算
4. src/constraints.py - 约束检查
5. src/splitter.py - 拆票模块
6. src/allocator.py - 分配引擎
7. src/utils.py - 工具函数
8. src/example.py - 简单示例
9. examples/basic_example.py - 完整示例
10. tests/test_basic.py - 测试代码

### 配置文件（3个）
1. .gitignore - Git忽略配置
2. requirements.txt - 依赖说明
3. SUMMARY.md - 本概览文档

## 项目亮点

1. **完整的文档体系**: 从业务逻辑到数学模型到流程设计，文档齐全
2. **可运行的代码**: 提供完整可执行的Python实现
3. **丰富的示例**: 覆盖多种典型使用场景
4. **良好的代码结构**: 模块化设计，职责清晰
5. **详细的注释**: 代码和文档都有充分的说明
6. **可扩展性强**: 易于添加新策略、新约束、新功能

## 适用场景

- 金融票据管理系统
- 应收账款配置
- 库存优化系统
- 资源分配系统
- 多约束组合优化问题

## 后续优化方向

1. **算法优化**: 引入更强的优化算法（整数规划、遗传算法）
2. **性能优化**: 支持更大规模的票据池
3. **策略学习**: 增加机器学习模块，自动调整参数
4. **可视化**: 添加配票结果的图形化展示
5. **API服务**: 封装为Web服务接口
6. **数据库集成**: 支持从数据库读取票据和订单

## 许可与使用

本项目仅用于学习和研究目的。
